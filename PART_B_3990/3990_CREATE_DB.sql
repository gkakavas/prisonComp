--create--
CREATE TABLE CUSTOMER(
    CUST_NO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    AT VARCHAR2(20) NOT NULL,
    FIRST_NAME VARCHAR2(40) NOT NULL,
    LAST_NAME VARCHAR2(40) NOT NULL,
    COUNTRY VARCHAR2(40) NOT NULL,
    CITY VARCHAR2(40) NOT NULL,
    STREET_NAME VARCHAR2(40) NOT NULL,
    STREET_NO NUMBER NOT NULL,
    POSTAL_CODE NUMBER(5) NOT NULL,
    REGISTRATION_DATE TIMESTAMP(6) NOT NULL,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY(CUST_NO,AT)
);


CREATE TABLE PHONENUM(
    FK_CUST_NO NUMBER NOT NULL,
    FK_AT VARCHAR2(20) NOT NULL,
    PHONE NUMBER NOT NULL,
    PHONE2 NUMBER,
    CONSTRAINT PK_PHONENUM PRIMARY KEY (FK_CUST_NO,FK_AT),
    CONSTRAINT FK_CUSTOMER FOREIGN KEY (FK_CUST_NO,FK_AT) REFERENCES CUSTOMER(CUST_NO,AT) ON DELETE CASCADE
);

CREATE TABLE CATEGORY(
    NAME VARCHAR2(40) NOT NULL,
    ROOMPRICE NUMBER NOT NULL,
    ROOMCOUNT NUMBER NOT NULL,
    CONSTRAINT PK_CATEGORY PRIMARY KEY(NAME)
);

CREATE TABLE FACILITY(
    NAME VARCHAR2(40) NOT NULL,
    DAILY_PRICE NUMBER NOT NULL,
    CONSTRAINT PK_FACILITY PRIMARY KEY (NAME)
);

CREATE TABLE ROOM(
    ROOM_NUMBER NUMBER NOT NULL,
    CATEGORY_NAME VARCHAR2(40) NOT NULL,
    FLOOR NUMBER NOT NULL,
    SQUARE_METERS NUMBER NOT NULL,
    BOOK_TIMES NUMBER NOT NULL,
    CONSTRAINT PK_ROOM PRIMARY KEY (ROOM_NUMBER, CATEGORY_NAME),
    CONSTRAINT FK_CATEGORY FOREIGN KEY (CATEGORY_NAME) REFERENCES CATEGORY(NAME) ON DELETE CASCADE
);

CREATE TABLE BOOKING(
    BOOK_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    BOOK_IN_DATE TIMESTAMP(6) NOT NULL,
    CUST_NO NUMBER NOT NULL,
    AT VARCHAR2(20) NOT NULL,
    ROOM_NUMBER NUMBER NOT NULL,
    CATEGORY_NAME VARCHAR2(40) NOT NULL,
    BILL NUMBER,
    BOOK_OUT_DATE TIMESTAMP(6),
    CONSTRAINT PK_BOOKING PRIMARY KEY(BOOK_ID, BOOK_IN_DATE, CUST_NO, AT, ROOM_NUMBER, CATEGORY_NAME),
    CONSTRAINT FK_CUST FOREIGN KEY (CUST_NO,AT) REFERENCES CUSTOMER(CUST_NO,AT) ON DELETE CASCADE,
    CONSTRAINT FK_ROOM FOREIGN KEY (ROOM_NUMBER, CATEGORY_NAME) REFERENCES ROOM(ROOM_NUMBER, CATEGORY_NAME) ON DELETE CASCADE
);

CREATE TABLE FACILITIES(
    FACILITY_NAME VARCHAR2(40) NOT NULL,
    CATEGORY_NAME VARCHAR2(40) NOT NULL,
    ROOM_NUMBER NUMBER NOT NULL,
    CONSTRAINT PK_FACILITIES PRIMARY KEY (FACILITY_NAME, CATEGORY_NAME, ROOM_NUMBER),
    CONSTRAINT FK_ROOM2 FOREIGN KEY (CATEGORY_NAME, ROOM_NUMBER) REFERENCES ROOM (CATEGORY_NAME, ROOM_NUMBER) ON DELETE CASCADE,
    CONSTRAINT FK_FACILITY FOREIGN KEY (FACILITY_NAME) REFERENCES FACILITY (NAME) ON DELETE CASCADE
);









